name: Sync Docs to Wiki

on:
    push:
        branches:
            - main
        paths:
            - 'docs/**/*.md'

jobs:
    sync:
        runs-on: ubuntu-latest

        permissions:
            contents: write # âœ… å¿…é¡»å¼€å¯å†™å…¥æƒé™ï¼Œå…è®¸ push

        steps:
            - name: Checkout main repo
              uses: actions/checkout@v4
              with:
                  fetch-depth: 1

            - name: Clone Wiki repository
              run: |
                  git clone https://github.com/${{ github.repository }}.wiki.git wiki

            - name: Sync docs to wiki
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  # æ¸…ç†å¹¶å¤åˆ¶æ–‡æ¡£
                  rm -rf wiki/*

                  # åˆ›å»ºç®€å•çš„é¦–é¡µ
                  cat > wiki/Home.md << 'EOF'
                  # è®¾è®¡æ¨¡å¼å®žè·µæŒ‡å—

                  ## ðŸ—ï¸ åˆ›å»ºåž‹æ¨¡å¼
                  - [å•ä¾‹æ¨¡å¼](SingletonPattern)
                  - [å·¥åŽ‚æ–¹æ³•æ¨¡å¼](FactoryMethodPattern) 
                  - [æŠ½è±¡å·¥åŽ‚æ¨¡å¼](AbstractFactoryPattern)
                  - [å»ºé€ è€…æ¨¡å¼](BuilderPattern)
                  - [åŽŸåž‹æ¨¡å¼](PrototypePattern)

                  ## ðŸ”§ ç»“æž„åž‹æ¨¡å¼
                  - [é€‚é…å™¨æ¨¡å¼](AdapterPattern)

                  ## ðŸ“Š å¯¹æ¯”æ€»ç»“
                  - [åˆ›å»ºåž‹æ¨¡å¼å¯¹æ¯”](CreationalPatternsComparison)
                  EOF

                  # ç›´æŽ¥å¤åˆ¶æ–‡æ¡£
                  cp docs/CreationalPatterns/*.md wiki/
                  cp docs/StructuralPatterns/*.md wiki/
                  cp docs/Comparisons/*.md wiki/
                  cp docs/Getting-Started.md docs/FAQ.md docs/NOTION_SETUP.md wiki/

                  # æäº¤åˆ° Wiki
                  cd wiki
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git remote set-url origin https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.wiki.git

                  git add .
                  git commit -m "ðŸ“š Sync docs" || echo "No changes"
                  git push origin master || echo "Push completed"
